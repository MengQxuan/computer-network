## 书面作业1

>**学号：2212452\
姓名：孟启轩\
专业：计算机科学与技术**
---
### 习题1-1解答
![](1.1.jpg)

#### （3）如果考虑报文在路由器中的路由决策与排队过程，那么端到端延时不确定性的来源及影响最大的因素
##### 来源
- **路由器路由决策延时**: 路由器处理报文时，查找转发表可能增加不可预测的延时。
- **排队延时**: 链路拥塞时，报文需要等待转发，影响传输时间。
- **转发设备处理时间**: 转发设备处理报文时，报头解析、差错检测、分片等操作也会引入延时。
- **其他设备开销**: 设备之间链路不稳定可能引入更多延迟。
##### 影响最大的因素
**排队延时**是影响端到端延时不确定性的最大因素，其动态变化性使其直接受到链路利用率和网络拥塞情况的实时影响，排队延时难以预估。此外，排队延时还具有累积效应，网络路径中的每个路由器都会增加排队延时，路径越长累积效应越显著。

---
### 习题1-2解答
##### **什么是nslookup？**
`nslookup`是一种用于查询**DNS**的网络命令工具，全称是`NameServerLookup`。它可以帮助用户解析域名为IP地址，或者反向解析IP地址为域名。

##### 作用
1. **域名解析**: 将域名转换为对应的IP地址。
2. **反向解析**: 查询某个IP地址对应的域名。
3. **诊断网络问题**: 检查域名解析是否正常，验证DNS服务器是否工作。
4. **获取DNS服务器信息**: 查看当前使用的DNS服务器。

##### 解析:
1. **Server**: 表示当前的DNS服务器。
2. **Address**: 显示DNS服务器的IP地址。
3. **Non-authoritativeanswer**: 表示DNS服务器返回的非权威结果（可能来自缓存）。
4. **Name和Address**: 显示目标域名及其对应的IP地址。

#### (1) nslookup查询结果及分析
![](1.2.png)
#### 分析

##### 1. 服务器信息
```c
服务器:  41.45.30.222.in-addr.arpa  
Address:  222.30.45.41
```
- **服务器**: 显示当前系统使用的DNS服务器的反向解析地址（`41.45.30.222.in-addr.arpa`）。
- **Address**: 当前使用的DNS服务器的IP地址（`222.30.45.41`）。
- 这些信息表明查询请求是通过该 DNS 服务器完成的。

##### 2. 非权威应答
```c
非权威应答:
```
- 表示返回的DNS结果是非权威的，说明所查询的域名解析结果是从缓存中返回的，而非直接来自域名的权威DNS服务器。
- 缓存结果通常由上游DNS服务器提供，用于加速查询。

##### 3. 名称和地址信息
```c
名称:    www.163.com.w.kunluncan.com  
Addresses:  240e:904:800:1804:3::3f7  
            240e:904:800:1804:3::3f8  
            220.181.164.205  
            220.181.164.208  
            220.181.164.210  
            220.181.164.204  
            220.181.164.206  
            220.181.164.203  
            220.181.164.207  
            220.181.164.209
```

- **名称**:
  - `www.163.com.w.kunluncan.com`: 这是 `www.163.com` 的一个 CNAME（别名）记录，表明当前查询的域名可能被加速或代理服务处理。
  - 显示该域名正在通过 `kunluncan.com` 提供服务，这可能与网络加速服务（如CDN）相关。

- **IPv6 地址**:
  - `240e:904:800:1804:3::3f7` 和 `240e:904:800:1804:3::3f8` 是 `www.163.com` 的 IPv6 地址，适用于支持 IPv6 协议的客户端。

- **IPv4 地址**:
  - `220.181.164.205`, `220.181.164.208`, `220.181.164.210` 等是 `www.163.com` 的 IPv4 地址。
  - 这些地址属于 `163.com` 网站的多个服务器，可能用于负载均衡或地理分布式部署。

- 解析结果返回了多个 IPv4 和 IPv6 地址，表明网站使用了多服务器架构（负载均衡）。

##### 4. 别名信息
```c
Aliases:  www.163.com  
          www.163.com.163jiasu.com
```
- `Aliases` 显示 `www.163.com` 的别名记录。
- `www.163.com.163jiasu.com` 表示域名通过 `163jiasu.com` 提供的服务进行加速，这进一步验证了使用了CDN（内容分发网络）服务。

#### （2） Wireshark捕获结果及分析
![](1.3.png)

##### 每条DNS报文的用途解析如下：

##### 2872：PTR 查询
```c
Standard query 0x0001 PTR 41.45.30.222.in-addr.arpa
```
- **用途**: 这是一个 **反向解析（PTR 查询）** 报文。
  - 查询目标: 将IP地址 `222.30.45.41` 转换为其对应的域名（反向域名解析）。
  - 发送方: 客户端 `10.130.70.57`。
  - 接收方: DNS服务器 `222.30.45.41`。

##### **2874：PTR 响应**
```c
Standard query response 0x0001 PTR 41.45.30.222.in-addr.arpa PTR 41.45.30.222.in-addr.arpa
```
- **用途**: 这是 **PTR查询的响应** 。
  - DNS服务器确认，`222.30.45.41` 的反向解析结果为 `41.45.30.222.in-addr.arpa`。
  - 说明目标IP没有配置一个常见的域名，而是保留了默认的反向域名形式。

##### **2875：A 记录查询**
```c
Standard query 0x0002 A www.163.com
```
- **用途**: 这是一个 **正向解析（A 查询）** 报文。
  - 查询目标: 解析域名 `www.163.com` 的IPv4地址。
  - 发送方: 客户端 `10.130.70.57`。
  - 接收方: DNS服务器 `222.30.45.41`。

##### **2876：A 记录响应**
```c
Standard query response 0x0002 A www.163.com CNAME www.163.com.163jiasu.com CNAME www.163.com.w.kunluncan.com A 220.181.164.205 A 220.181.164.208 A 220.181.164.210 A 220.181.164.204 A 220.181.164.206 A 220.181.164.203 A 220.181.164.207 A 220.181.164.209
```
- **用途**: 这是 **A查询的响应** 。
  - 返回结果包含多个IPv4地址，这些地址是 `www.163.com` 使用的服务器IP。
  - 同时返回了别名信息，说明 `www.163.com` 被代理或加速。

##### **2877：AAAA 记录查询**
```c
Standard query 0x0003 AAAA www.163.com
```

- **用途**: 这是一个 **正向解析（AAAA 查询）** 报文。
  - 查询目标: 解析域名 `www.163.com` 的IPv6地址。
  - 发送方: 客户端 `10.130.70.57`。
  - 接收方: DNS服务器 `222.30.45.41`。

##### **2878：AAAA 记录响应**
```c
Standard query response 0x0003 AAAA www.163.com CNAME www.163.com.163jiasu.com CNAME www.163.com.w.kunluncan.com AAAA 240e:904:800:1804:3::3f7 AAAA 240e:904:800:1804:3::3f8
```
- **用途**: 这是 **AAAA查询的响应** 。
  - 返回结果包含多个IPv6地址，表明 `www.163.com` 支持IPv6协议。
  - 同样返回了别名信息，说明域名被代理或加速处理。


#### （3）提供某个DNS报文详细信息，说明DNS服务使用哪种传输层协议，以及哪些措施可提高DNS服务可靠性

> 我选择了PTR响应报文

![](1.4.png)

##### 1. DNS使用的传输层协议

###### 从报文信息中可以看到：
- **协议字段**: `User Datagram Protocol (UDP)`
- **源端口**: 53
- **目标端口**: 65231

> DNS服务通常使用 **UDP 协议**，主要原因是：

- UDP无连接，速度快，适合小型请求和响应的快速传递。
- 对于绝大多数DNS查询来说，响应报文较小，不需要使用复杂的连接协议。

##### 2. **提高DNS服务可靠性的措施**

###### **（1）使用冗余 DNS 服务器**
- 部署多个 DNS 服务器，分布在不同地理位置。
- 提高查询的容错性，当一个服务器不可用时，可以切换到其他服务器。

###### **（2）启用缓存机制**
- 客户端和 DNS 服务器均可以缓存查询结果。
- 减少重复查询的负载，加快域名解析速度。

###### **（3）使用 Anycast 技术**
- 通过 Anycast，多个 DNS 服务器可以共享一个 IP 地址。
- 查询请求会路由到最近或最优的服务器，提高访问效率。

###### **（4）启用 DNSSEC（DNS 安全扩展）**
- 防止 DNS 劫持和中间人攻击。
- 提供查询结果的真实性和完整性验证。

###### **（5）必要时切换到 TCP 协议**
- 对于大报文或需要可靠传输时，切换到 TCP 协议以避免数据丢失。

###### **（6）负载均衡**
- 利用负载均衡技术分配查询流量，防止单点瓶颈或过载。

###### **（7）定期更新和维护**
- 定期更新 DNS 服务器软件以修复漏洞。
- 监控服务器状态，及时处理故障。
